package {{.PackageName}}

import (
	"ouaf/pkg/config"
	"ouaf/pkg/client"
	"ouaf/pkg/cmdutil"

	"github.com/DataDog/datadog-api-client-go/v2/api/datadogV2"
	{{range .ArgTypes}}{{if eq . "uuid.UUID"}}"github.com/google/uuid"{{break}}{{end}}{{end}}
	{{range .ArgTypes}}{{if eq . "time.Time"}}"time"{{break}}{{end}}{{end}}
	{{range .ArgTypes}}{{if eq . "[]string"}}"strings"{{break}}{{end}}{{end}}
	"github.com/spf13/cobra"
	{{range .ArgTypes}}{{if eq . "int64"}}"strconv"{{break}}{{end}}{{end}}
)

var {{.CommandName}} = &cobra.Command{
	Use:   "{{.Use}}",
	{{if .Aliases}}Aliases: []string{ {{range .Aliases}}"{{.}}",{{end}} },{{end}}
	Short: "{{.Short}}",
	{{if .Args}}Args:  cobra.ExactArgs({{len .Args}}),{{end}}
	Run: func(cmd *cobra.Command, args []string) {
		apiKey, appKey, site := config.GetConfig()
		api := datadogV2.New{{.ApiBundleName}}Api(client.NewAPIClient())
		{{if .HasResponse}}res, _, err := {{else}}_, err := {{end}}api.{{.OperationID}}(client.NewContext(apiKey, appKey, site){{range $i, $type := .ArgTypes}}{{if eq $type "uuid.UUID"}}, uuid.MustParse(args[{{$i}}]){{else if eq $type "int64"}}, func() int64 { i, _ := strconv.ParseInt(args[{{$i}}], 10, 64); return i }(){{else if eq $type "float64"}}, func() float64 { f, _ := strconv.ParseFloat(args[{{$i}}], 64); return f }(){{else if eq $type "time.Time"}}, func() time.Time { t, _ := time.Parse(time.RFC3339, args[{{$i}}]); return t }(){{else if eq $type "datadogV2.AssetType"}}, datadogV2.AssetType(args[{{$i}}]){{else if eq $type "datadogV2.TeamSyncAttributesSource"}}, datadogV2.TeamSyncAttributesSource(args[{{$i}}]){{else if eq $type "[]string"}}, strings.Split(args[{{$i}}], ","){{else}}, args[{{$i}}]{{end}}{{end}}{{if .HasRequestBody}}{{if .IsOptionalParams}}, *datadogV2.New{{.RequestBodyType}}(){{else}}, datadogV2.{{.RequestBodyType}}{}{{end}}{{end}})
		cmdutil.HandleError(err, "failed to {{.OperationID | toKebabCase}}")

		{{if .HasResponse}}cmd.Println(cmdutil.FormatJSON(res, "{{.ResourceType}}")){{end}}
	},
}

func init() {
	Cmd.AddCommand({{.CommandName}})
}
